<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Quiver – Earthquake Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #de7a7c;
            --primary-dark: #c96366;
            --primary-light: #e59194;
            --primary-lighter: #f2d4d5;
            --secondary: #8b5a5c;
            --background: #fdfcfc;
            --surface: #ffffff;
            --surface-hover: #faf9f9;
            --text-primary: #2d1b1c;
            --text-secondary: #6b4c4d;
            --text-muted: #8b7475;
            --border: #e8dede;
            --border-light: #f0ecec;
            --accent-orange: #e6956b;
            --accent-yellow: #d4b56e;
            --accent-blue: #7ba3d4;
            --accent-green: #88b894;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1.5rem 2rem;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .control-group label {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.95;
            min-width: 50px;
        }

        select, button {
            padding: 0.6rem 1.2rem;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        select:hover, select:focus {
            background: white;
            border-color: rgba(255, 255, 255, 0.4);
            outline: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        button {
            background: var(--text-primary);
            color: white;
            border-color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            background: var(--secondary);
            border-color: var(--secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45, 27, 28, 0.25);
        }

        .status-indicator {
            background: rgba(136, 184, 148, 0.15);
            color: var(--accent-green);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid rgba(136, 184, 148, 0.3);
        }

        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(222, 122, 124, 0.08);
            text-align: center;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(222, 122, 124, 0.12);
            border-color: var(--primary-lighter);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .map-section {
            background: var(--surface);
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 20px rgba(222, 122, 124, 0.06);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .map-header {
            background: var(--surface-hover);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 1.5rem;
        }

        .map-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        #map {
            width: 100%;
            height: 550px;
            border: none;
        }

        .info-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(222, 122, 124, 0.06);
        }

        .info-panel h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .info-panel p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Enhanced popup styling */
        .leaflet-popup-content-wrapper {
            background: white;
            border-radius: 12px;
            box-shadow: 0 12px 40px rgba(222, 122, 124, 0.15);
            border: 1px solid var(--border);
        }

        .leaflet-popup-content {
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        .earthquake-popup {
            padding: 1.25rem;
            min-width: 280px;
        }

        .earthquake-popup h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0 0 1rem 0;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-lighter);
        }

        .popup-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.6rem 0;
            font-size: 0.9rem;
        }

        .popup-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .popup-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .classification-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-major { 
            background: rgba(222, 122, 124, 0.15); 
            color: var(--primary-dark); 
            border: 1px solid rgba(222, 122, 124, 0.3);
        }
        .badge-moderate { 
            background: rgba(230, 149, 107, 0.15); 
            color: #b8732f; 
            border: 1px solid rgba(230, 149, 107, 0.3);
        }
        .badge-light { 
            background: rgba(212, 181, 110, 0.15); 
            color: #a0853e; 
            border: 1px solid rgba(212, 181, 110, 0.3);
        }
        .badge-minor { 
            background: rgba(123, 163, 212, 0.15); 
            color: #4a7bb0; 
            border: 1px solid rgba(123, 163, 212, 0.3);
        }

        .location-text {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-light);
            color: var(--text-secondary);
            line-height: 1.4;
            font-size: 0.85rem;
        }

        /* Custom legend */
        .custom-legend {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 6px 20px rgba(222, 122, 124, 0.12);
            font-size: 0.85rem;
        }

        .legend-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin: 0.5rem 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .legend-text {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .error {
            background: rgba(222, 122, 124, 0.1);
            border: 1px solid rgba(222, 122, 124, 0.3);
            color: var(--primary-dark);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            margin: 1rem 0;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .loading::before {
            content: '';
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Enhanced Leaflet controls */
        .leaflet-control-zoom a {
            background: var(--surface) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border) !important;
            box-shadow: 0 2px 8px rgba(222, 122, 124, 0.1) !important;
        }

        .leaflet-control-zoom a:hover {
            background: var(--surface-hover) !important;
            border-color: var(--primary-lighter) !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 2rem 0;
            }
            
            .header h1 {
                font-size: 1.875rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 1rem;
                padding: 1.25rem;
            }
            
            .control-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .main {
                padding: 1rem;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            #map {
                height: 450px;
            }
            
            .earthquake-popup {
                min-width: 250px;
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>Project Quiver – Earthquake Map</h1>
            <p class="subtitle">Daily Maximum Seismic Events Visualization</p>
            <div class="controls">
                <div class="control-group">
                    <label>Year:</label>
                    <select id="yearSelect">
                        <option value="2020">2020</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Month:</label>
                    <select id="monthSelect">
                        <option value="JAN">January</option>
                        <option value="FEB">February</option>
                        <option value="MAR">March</option>
                        <option value="APR">April</option>
                    </select>
                </div>
                <button id="loadBtn">Load Data</button>
                <div id="status" class="status-indicator">Ready</div>
            </div>
        </div>
    </div>

    <div class="main">
        <div class="stats" id="statsContainer">
            <div class="stat-card">
                <div class="stat-value" id="maxMagnitude">0.0</div>
                <div class="stat-label">Max Magnitude</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgMagnitude">0.0</div>
                <div class="stat-label">Avg Magnitude</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxDepth">0</div>
                <div class="stat-label">Max Depth (km)</div>
            </div>
        </div>

        <div class="map-section">
            <div class="map-header">
                <h3 class="map-title">Interactive Seismic Map</h3>
            </div>
            <div id="map"></div>
        </div>

        <div class="info-panel">
            <h3>Data Methodology</h3>
            <p>
                This visualization displays the highest magnitude earthquake recorded each calendar day during the selected month, 
                based on seismic monitoring data from the Philippines region. Each marker represents the most significant seismic event 
                for that specific date in Philippine Standard Time. The color-coded classification system provides immediate visual 
                assessment of earthquake severity and regional seismic activity patterns.
            </p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map
        const map = L.map('map').setView([12.8797, 121.7740], 6);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Add custom legend
        const legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'custom-legend');
            div.innerHTML = `
                <div class="legend-title">Magnitude Scale</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #de7a7c;"></div>
                    <span class="legend-text">≥ 6.0 Major</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #e6956b;"></div>
                    <span class="legend-text">5.0-5.9 Moderate</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #d4b56e;"></div>
                    <span class="legend-text">4.0-4.9 Light</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #7ba3d4;"></div>
                    <span class="legend-text">< 4.0 Minor</span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);

        let markers = [];
        
        function updateStatus(message, type = 'ready') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status-indicator';
        }

        function updateStats(data) {
            if (!data || data.length === 0) {
                document.getElementById('maxMagnitude').textContent = '0.0';
                document.getElementById('avgMagnitude').textContent = '0.0';
                document.getElementById('maxDepth').textContent = '0';
                return;
            }

            const magnitudes = data.map(eq => parseFloat(eq.magnitude) || 0);
            const depths = data.map(eq => parseFloat(eq.depth) || 0);

            document.getElementById('maxMagnitude').textContent = Math.max(...magnitudes).toFixed(1);
            document.getElementById('avgMagnitude').textContent = (magnitudes.reduce((a, b) => a + b, 0) / magnitudes.length).toFixed(1);
            document.getElementById('maxDepth').textContent = Math.max(...depths).toFixed(0);
        }

        function clearMarkers() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }

        function getColor(magnitude) {
            if (magnitude >= 6) return '#de7a7c';  // Primary red
            if (magnitude >= 5) return '#e6956b';  // Orange
            if (magnitude >= 4) return '#d4b56e';  // Yellow
            return '#7ba3d4';  // Blue
        }

        function getClassification(magnitude) {
            if (magnitude >= 6) return { class: 'badge-major', label: 'Major' };
            if (magnitude >= 5) return { class: 'badge-moderate', label: 'Moderate' };
            if (magnitude >= 4) return { class: 'badge-light', label: 'Light' };
            return { class: 'badge-minor', label: 'Minor' };
        }

        async function loadData() {
            const month = document.getElementById('monthSelect').value;
            const filename = `${month}2020.json`;
            
            updateStatus('Loading...');
            clearMarkers();
            
            try {
                const response = await fetch(filename);
                
                if (!response.ok) {
                    throw new Error(`File ${filename} not found`);
                }
                
                const data = await response.json();
                
                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('No earthquake data found');
                }
                
                // Update statistics
                updateStats(data);
                
                // Plot earthquakes
                data.forEach(eq => {
                    const lat = parseFloat(eq.latitude);
                    const lng = parseFloat(eq.longitude);
                    const mag = parseFloat(eq.magnitude) || 0;
                    
                    if (!lat || !lng) return;
                    
                    const classification = getClassification(mag);
                    
                    const marker = L.circleMarker([lat, lng], {
                        radius: Math.max(mag * 2.5, 6),
                        fillColor: getColor(mag),
                        color: '#ffffff',
                        weight: 2,
                        fillOpacity: 0.9
                    });
                    
                    const popupContent = `
                        <div class="earthquake-popup">
                            <h4>Magnitude ${mag} Earthquake</h4>
                            <div class="popup-row">
                                <span class="popup-label">Classification:</span>
                                <span class="classification-badge ${classification.class}">${classification.label}</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Date:</span>
                                <span class="popup-value">${eq.date}</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Depth:</span>
                                <span class="popup-value">${eq.depth} km</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Coordinates:</span>
                                <span class="popup-value">${lat.toFixed(2)}°N, ${lng.toFixed(2)}°E</span>
                            </div>
                            <div class="location-text">
                                <strong>Location:</strong><br>
                                ${eq.location}
                            </div>
                        </div>
                    `;
                    
                    marker.bindPopup(popupContent);
                    marker.addTo(map);
                    markers.push(marker);
                });
                
                // Fit map to markers
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.1));
                }
                
                updateStatus(`${data.length} events loaded`);
                
            } catch (error) {
                console.error('Error:', error);
                updateStatus('Error loading data');
                updateStats([]);
                document.getElementById('map').innerHTML = `
                    <div class="error">
                        <h3>Unable to load ${filename}</h3>
                        <p>Please ensure the data file exists and is properly formatted.</p>
                    </div>
                `;
            }
        }

        // Event listeners
        document.getElementById('loadBtn').addEventListener('click', loadData);
        document.getElementById('monthSelect').addEventListener('change', loadData);
        
        // Load January data on start
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('Initializing...');
            setTimeout(loadData, 300);
        });
    </script>
</body>
</html>
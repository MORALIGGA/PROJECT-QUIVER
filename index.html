<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Quiver – Earthquake Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-600: #475569;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .header-content {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 1.5rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 500;
            font-size: 0.9rem;
            opacity: 0.9;
            min-width: 80px;
        }

        select, button {
            padding: 0.6rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--gray-800);
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 120px;
            font-size: 0.9rem;
        }

        select:hover, select:focus {
            background: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            outline: none;
        }

        button {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            cursor: pointer;
            font-weight: 600;
            min-width: 100px;
        }

        button:hover {
            background: #0891b2;
            border-color: #0891b2;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
        }

        button:disabled {
            background: var(--gray-400);
            border-color: var(--gray-400);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .status-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .main-content {
            padding: 2rem 0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--gray-200);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.3rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .map-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
        }

        #map {
            width: 100%;
            height: 600px;
        }

        .info-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--gray-200);
            padding: 1.5rem;
        }

        .info-panel h3 {
            margin-bottom: 1rem;
            color: var(--gray-800);
            font-weight: 600;
        }

        .info-panel p {
            color: var(--gray-600);
            line-height: 1.7;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .loading::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-300);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }

        /* Enhanced Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--gray-200);
        }

        .leaflet-popup-content {
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        .earthquake-popup {
            min-width: 280px;
            padding: 1rem;
        }

        .earthquake-popup h4 {
            margin: 0 0 0.8rem 0;
            color: var(--gray-900);
            font-weight: 600;
            font-size: 1.1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .earthquake-popup .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.4rem 0;
            font-size: 0.9rem;
        }

        .earthquake-popup .info-label {
            font-weight: 500;
            color: var(--gray-600);
        }

        .earthquake-popup .info-value {
            font-weight: 600;
            color: var(--gray-800);
        }

        .magnitude-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }

        .magnitude-major { background: var(--danger); }
        .magnitude-moderate { background: var(--warning); }
        .magnitude-light { background: #eab308; }
        .magnitude-minor { background: var(--primary); }

        /* Custom Leaflet Controls */
        .leaflet-control-zoom a {
            background: white !important;
            color: var(--gray-800) !important;
            border: 1px solid var(--gray-300) !important;
            font-weight: 600 !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        }

        .leaflet-control-zoom a:hover {
            background: var(--gray-50) !important;
            transform: translateY(-1px);
        }

        /* Legend Styles */
        .custom-legend {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            font-size: 0.85rem;
            min-width: 160px;
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 0.7rem;
            color: var(--gray-800);
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 0.4rem 0;
            gap: 0.6rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .legend-text {
            color: var(--gray-700);
            font-weight: 500;
        }

        /* Footer */
        .footer {
            background: var(--gray-900);
            color: var(--gray-300);
            text-align: center;
            padding: 1.5rem 0;
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { 
                font-size: 2.2rem; 
            }
            .header .subtitle { 
                font-size: 1rem; 
            }
            .controls { 
                flex-direction: column; 
                gap: 0.8rem;
                padding: 1rem; 
            }
            .control-group {
                width: 100%;
                justify-content: space-between;
            }
            .control-group label {
                min-width: auto;
            }
            select, button {
                min-width: 140px;
            }
            #map { 
                height: 450px; 
            }
            .stats { 
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }
            .stat-card {
                padding: 1rem;
            }
            .stat-value {
                font-size: 1.5rem;
            }
            .container {
                padding: 0 1rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 1.5rem 0;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .stats {
                grid-template-columns: 1fr;
            }
            #map {
                height: 400px;
            }
            .earthquake-popup {
                min-width: 240px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1>Project Quiver – Earthquake Map</h1>
                <p class="subtitle">Visualizing the most significant earthquakes each day</p>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label for="yearSelect">Year:</label>
                    <select id="yearSelect">
                        <option value="2020">2020</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="monthSelect">Month:</label>
                    <select id="monthSelect">
                        <option value="JAN">January</option>
                        <option value="FEB">February</option>
                        <option value="MAR">March</option>
                        <option value="APR">April</option>
                    </select>
                </div>
                <button id="filterBtn">Load Data</button>
                <div class="status-badge" id="statusBadge">Ready</div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="stats" id="statsContainer">
                <div class="stat-card">
                    <div class="stat-value" id="totalEvents">0</div>
                    <div class="stat-label">Total Events</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="maxMagnitude">0.0</div>
                    <div class="stat-label">Max Magnitude</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgMagnitude">0.0</div>
                    <div class="stat-label">Avg Magnitude</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="maxDepth">0</div>
                    <div class="stat-label">Max Depth (km)</div>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
            </div>

            <div class="info-panel">
                <h3>About This Visualization</h3>
                <p>
                    This interactive map displays the most significant earthquake recorded each day during the selected month in 2020, 
                    focusing on seismic activity in and around the Philippines. Each marker represents the highest magnitude 
                    earthquake for that calendar day in Philippine Time. Click on any marker to view detailed information including 
                    precise location, magnitude, depth, and date. The color coding helps identify earthquake severity at a glance.
                </p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            © 2025 Project Quiver. All rights reserved.
        </div>
    </footer>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize the map centered over the Philippines
        var map = L.map('map').setView([12.8797, 121.7740], 6);
        var currentMarkers = [];

        // Add the OpenStreetMap tile layer with better styling
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Add scale control
        L.control.scale({ 
            position: 'bottomleft', 
            metric: true, 
            imperial: false 
        }).addTo(map);

        // Add custom legend
        var legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'custom-legend');
            div.innerHTML = `
                <div class="legend-title">Magnitude Scale</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ef4444;"></div>
                    <span class="legend-text">≥ 6.0 Major</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span class="legend-text">5.0-5.9 Moderate</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #eab308;"></div>
                    <span class="legend-text">4.0-4.9 Light</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3b82f6;"></div>
                    <span class="legend-text">< 4.0 Minor</span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);

        // Function to get color based on magnitude
        function getEarthquakeColor(magnitude) {
            if (magnitude >= 6) return '#ef4444';  // Red - Major
            if (magnitude >= 5) return '#f59e0b';  // Orange - Moderate
            if (magnitude >= 4) return '#eab308';  // Yellow - Light
            return '#3b82f6';  // Blue - Minor
        }

        // Function to get magnitude classification
        function getMagnitudeClass(magnitude) {
            if (magnitude >= 6) return 'magnitude-major';
            if (magnitude >= 5) return 'magnitude-moderate';
            if (magnitude >= 4) return 'magnitude-light';
            return 'magnitude-minor';
        }

        // Function to get magnitude label
        function getMagnitudeLabel(magnitude) {
            if (magnitude >= 6) return 'Major';
            if (magnitude >= 5) return 'Moderate';
            if (magnitude >= 4) return 'Light';
            return 'Minor';
        }

        // Function to update statistics
        function updateStatistics(data) {
            if (!data || data.length === 0) {
                document.getElementById('totalEvents').textContent = '0';
                document.getElementById('maxMagnitude').textContent = '0.0';
                document.getElementById('avgMagnitude').textContent = '0.0';
                document.getElementById('maxDepth').textContent = '0';
                return;
            }

            const magnitudes = data.map(eq => parseFloat(eq.magnitude) || 0);
            const depths = data.map(eq => parseFloat(eq.depth) || 0);

            document.getElementById('totalEvents').textContent = data.length;
            document.getElementById('maxMagnitude').textContent = Math.max(...magnitudes).toFixed(1);
            document.getElementById('avgMagnitude').textContent = (magnitudes.reduce((a, b) => a + b, 0) / magnitudes.length).toFixed(1);
            document.getElementById('maxDepth').textContent = Math.max(...depths).toFixed(0);
        }

        // Function to update status badge
        function updateStatus(message, type = 'info') {
            const badge = document.getElementById('statusBadge');
            badge.textContent = message;
            badge.className = 'status-badge';
            if (type === 'loading') {
                badge.style.opacity = '0.8';
            } else {
                badge.style.opacity = '1';
            }
        }

        // Function to load and plot earthquake data
        function loadEarthquakeData() {
            const month = document.getElementById('monthSelect').value;
            const fileName = `${month}2020.json`;
            
            // Update status
            updateStatus('Loading...', 'loading');
            
            // Clear existing markers
            currentMarkers.forEach(marker => map.removeLayer(marker));
            currentMarkers = [];

            fetch(fileName)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Could not load ${fileName}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Update statistics
                    updateStatistics(data);
                    
                    // Plot earthquakes
                    data.forEach(eq => {
                        const magnitude = parseFloat(eq.magnitude) || 0;
                        const lat = parseFloat(eq.latitude);
                        const lng = parseFloat(eq.longitude);
                        
                        if (isNaN(lat) || isNaN(lng)) return;

                        const marker = L.circleMarker([lat, lng], {
                            radius: Math.max(magnitude * 3, 6),
                            color: '#ffffff',
                            weight: 2,
                            fillColor: getEarthquakeColor(magnitude),
                            fillOpacity: 0.8
                        });

                        // Enhanced popup content
                        const popupContent = `
                            <div class="earthquake-popup">
                                <h4>Magnitude ${magnitude} Earthquake</h4>
                                <div class="info-row">
                                    <span class="info-label">Classification:</span>
                                    <span class="magnitude-badge ${getMagnitudeClass(magnitude)}">${getMagnitudeLabel(magnitude)}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Date:</span>
                                    <span class="info-value">${eq.date}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Depth:</span>
                                    <span class="info-value">${eq.depth} km</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Coordinates:</span>
                                    <span class="info-value">${lat.toFixed(2)}°N, ${lng.toFixed(2)}°E</span>
                                </div>
                                <div style="margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px solid #e5e7eb;">
                                    <div class="info-label" style="margin-bottom: 0.3rem;">Location:</div>
                                    <div style="color: #374151; font-weight: 500; line-height: 1.4;">${eq.location}</div>
                                </div>
                            </div>
                        `;

                        marker.bindPopup(popupContent);
                        marker.addTo(map);
                        currentMarkers.push(marker);
                    });

                    // Fit map to show all markers with padding
                    if (currentMarkers.length > 0) {
                        const group = new L.featureGroup(currentMarkers);
                        map.fitBounds(group.getBounds().pad(0.1));
                    }

                    // Update status
                    updateStatus(`Loaded ${data.length} events`);
                    
                })
                .catch(error => {
                    console.error('Error loading earthquake data:', error);
                    const mapDiv = document.getElementById('map');
                    mapDiv.innerHTML = `<div class="error">Failed to load ${fileName}. Please make sure the file exists in the same directory as this HTML file.</div>`;
                    updateStatus('Error loading data');
                    updateStatistics([]);
                });
        }

        // Event listeners
        document.getElementById('filterBtn').addEventListener('click', loadEarthquakeData);
        document.getElementById('monthSelect').addEventListener('change', loadEarthquakeData);

        // Load January data by default
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('Initializing...');
            setTimeout(() => {
                loadEarthquakeData();
            }, 500);
        });
    </script>
</body>
</html>